# Capital Gains – Test Scenarios (stdin → stdout)
# One scenario per block. Each stdin line is an independent simulation.
# Your CLI should read lines from stdin and output one JSON line per input with the list of taxes.

==================================================
Scenario 1 — Case #1 (isenção por valor bruto <= 20000)
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":100},{"operation":"sell","unit-cost":15.00,"quantity":50},{"operation":"sell","unit-cost":15.00,"quantity":50}]
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0}]

--------------------------------------------------
Scenario 2 — Case #2 (lucro tributável + prejuízo sem imposto)
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":10000},{"operation":"sell","unit-cost":20.00,"quantity":5000},{"operation":"sell","unit-cost":5.00,"quantity":5000}]
stdout:
[{"tax":0.0},{"tax":10000.0},{"tax":0.0}]

--------------------------------------------------
Scenario 3 — Case #1 + Case #2 (linhas independentes)
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":100},{"operation":"sell","unit-cost":15.00,"quantity":50},{"operation":"sell","unit-cost":15.00,"quantity":50}]
[{"operation":"buy","unit-cost":10.00,"quantity":10000},{"operation":"sell","unit-cost":20.00,"quantity":5000},{"operation":"sell","unit-cost":5.00,"quantity":5000}]
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0}]
[{"tax":0.0},{"tax":10000.0},{"tax":0.0}]

--------------------------------------------------
Scenario 4 — Case #3 (deduz prejuízo anterior em venda tributável)
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":10000},{"operation":"sell","unit-cost":5.00,"quantity":5000},{"operation":"sell","unit-cost":20.00,"quantity":3000}]
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":1000.0}]

--------------------------------------------------
Scenario 5 — Case #4 (média ponderada sem lucro/prejuízo)
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":10000},{"operation":"buy","unit-cost":25.00,"quantity":5000},{"operation":"sell","unit-cost":15.00,"quantity":10000}]
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0}]

--------------------------------------------------
Scenario 6 — Case #5 (lucro tributável após venda anterior no zero-a-zero)
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":10000},{"operation":"buy","unit-cost":25.00,"quantity":5000},{"operation":"sell","unit-cost":15.00,"quantity":10000},{"operation":"sell","unit-cost":25.00,"quantity":5000}]
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":10000.0}]

--------------------------------------------------
Scenario 7 — Case #6 (prejuízo isento que acumula + consumo de prejuízo + tributo final)
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":10000},{"operation":"sell","unit-cost":2.00,"quantity":5000},{"operation":"sell","unit-cost":20.00,"quantity":2000},{"operation":"sell","unit-cost":20.00,"quantity":2000},{"operation":"sell","unit-cost":25.00,"quantity":1000}]
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":3000.0}]

--------------------------------------------------
Scenario 8 — Case #7 (mix de isenção, dedução e nova média após recomprar)
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":10000},{"operation":"sell","unit-cost":2.00,"quantity":5000},{"operation":"sell","unit-cost":20.00,"quantity":2000},{"operation":"sell","unit-cost":20.00,"quantity":2000},{"operation":"sell","unit-cost":25.00,"quantity":1000},{"operation":"buy","unit-cost":20.00,"quantity":10000},{"operation":"sell","unit-cost":15.00,"quantity":5000},{"operation":"sell","unit-cost":30.00,"quantity":4350},{"operation":"sell","unit-cost":30.00,"quantity":650}]
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":3000.0},{"tax":0.0},{"tax":0.0},{"tax":3700.0},{"tax":0.0}]

--------------------------------------------------
Scenario 9 — Case #8 (grandes lucros tributáveis em duas janelas)
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":10000},{"operation":"sell","unit-cost":50.00,"quantity":10000},{"operation":"buy","unit-cost":20.00,"quantity":10000},{"operation":"sell","unit-cost":50.00,"quantity":10000}]
stdout:
[{"tax":0.0},{"tax":80000.0},{"tax":0.0},{"tax":60000.0}]

--------------------------------------------------
Scenario 10 — Case #9 (variações com isenção no bruto e dedução parcial de prejuízo)
stdin:
[{"operation":"buy","unit-cost":5000.00,"quantity":10},{"operation":"sell","unit-cost":4000.00,"quantity":5},{"operation":"buy","unit-cost":15000.00,"quantity":5},{"operation":"buy","unit-cost":4000.00,"quantity":2},{"operation":"buy","unit-cost":23000.00,"quantity":2},{"operation":"sell","unit-cost":20000.00,"quantity":1},{"operation":"sell","unit-cost":12000.00,"quantity":10},{"operation":"sell","unit-cost":15000.00,"quantity":3}]
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":1000.0},{"tax":2400.0}]

==================================================
Extra Scenarios (edge cases & rounding)
--------------------------------------------------
Scenario 11 — Rounding check on average (16.67)
stdin:
[{"operation":"buy","unit-cost":20.00,"quantity":10},{"operation":"sell","unit-cost":20.00,"quantity":5},{"operation":"buy","unit-cost":10.00,"quantity":5},{"operation":"sell","unit-cost":16.67,"quantity":10}]
# Média após segunda compra = ((5×20)+(5×10))/(10)=15.00; última venda a 16.67 → lucro 1.67×10=16.70 (após arredondamento), bruto = 166.70 > 20000? Não (é 166.70), logo isento e NÃO consome prejuízo.
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":0.0}]

--------------------------------------------------
Scenario 12 — Lucro com bruto <= 20000 não consome AccLoss
stdin:
[{"operation":"buy","unit-cost":100.00,"quantity":300},{"operation":"sell","unit-cost":50.00,"quantity":100},{"operation":"sell","unit-cost":110.00,"quantity":100}]
# 1) prejuízo 5000 acumula; 2) lucro (avg ~100), bruto=11000 ≤ 20000 → isento e NÃO abate prejuízo.
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0}]

--------------------------------------------------
Scenario 13 — Consome AccLoss apenas quando bruto > 20000
stdin:
[{"operation":"buy","unit-cost":100.00,"quantity":300},{"operation":"sell","unit-cost":50.00,"quantity":100},{"operation":"sell","unit-cost":120.00,"quantity":300}]
# Após prejuízo 5000, venda final bruto=36000>20000; lucro=(20×300)=6000 → tributa só sobre 1000 (depois de abater 5000) → imposto=200.00
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":200.0}]

--------------------------------------------------
Scenario 14 — Zera posição e recompra (média “resetada” pela prática)
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":1000},{"operation":"sell","unit-cost":10.00,"quantity":1000},{"operation":"buy","unit-cost":30.00,"quantity":1000},{"operation":"sell","unit-cost":35.00,"quantity":1000}]
# Segunda venda: lucro 5×1000=5000; bruto=35000>20000 → imposto=1000.00
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":1000.0}]

--------------------------------------------------
Scenario 15 — Mix: pequenas vendas isentas, depois venda grande tributável
stdin:
[{"operation":"buy","unit-cost":10.00,"quantity":3000},{"operation":"sell","unit-cost":12.00,"quantity":500},{"operation":"sell","unit-cost":13.00,"quantity":500},{"operation":"sell","unit-cost":25.00,"quantity":2000}]
# Vendas de 500 são isentas (brutos 6000 e 6500); depois venda de 2000 bruto=50000>20000. Média continua ~10 → lucro 15×2000=30000 → imposto=6000.00
stdout:
[{"tax":0.0},{"tax":0.0},{"tax":0.0},{"tax":6000.0}]

# End of file
